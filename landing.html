<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bull vs Bear : 1íšŒ ì²´í—˜</title>
  <!-- mini charts libs -->
  <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <style>
    :root{
      --bg:#0b0e11; --panel:#181a20; --panel2:#131722; --line:#2b3139;
      --gold:#f3ba2f; --muted:#9aa4b2; --green:#02c076; --red:#cf304a;
    }
    html,body{height:100%; margin:0; background:var(--bg); color:#fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
    .wrap{max-width:980px; margin:0 auto; padding:18px;}
    .card{background:rgba(24,26,32,0.85); border:1px solid rgba(243,186,47,0.22);
      border-radius:18px; padding:18px; box-shadow:0 18px 50px rgba(0,0,0,0.55); backdrop-filter: blur(6px);}
    .top{display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;}
    h1{margin:0; font-size:22px; letter-spacing:0.2px}
    .sub{color:var(--muted); margin-top:6px; font-size:13px; line-height:1.5}
    .pill{display:inline-flex; gap:8px; align-items:center; padding:8px 10px; border-radius:999px;
      border:1px solid rgba(209,212,220,0.18); background:rgba(24,26,32,0.55); color:#d1d4dc; font-weight:800; font-size:12px;}
    .grid{display:grid; grid-template-columns: 1.3fr 1fr; gap:14px; margin-top:14px;}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr;} }
    .panel{background:var(--panel2); border:1px solid var(--line); border-radius:16px; padding:14px;}
    .price{font-size:34px; font-weight:950; color:var(--gold); margin-top:6px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    label{font-size:12px; color:var(--muted); font-weight:800}
    input{background:#1e2329; border:1px solid #333; color:#fff; padding:12px; border-radius:10px;
      width:100%; box-sizing:border-box; font-size:14px;}
    .btn{cursor:pointer; border:none; border-radius:12px; font-weight:950; transition:0.18s; padding:14px 14px; font-size:16px;}
    .btn:hover{opacity:0.92}
    .btn-long{background:var(--green); color:#fff;}
    .btn-short{background:var(--red); color:#fff;}
    .btn-ghost{background:transparent; border:1px solid rgba(243,186,47,0.35); color:var(--gold);}
    .btn-dark{background:#fff; color:#000;}
    .muted{color:var(--muted); font-size:12px; line-height:1.5}
    .kv{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    .k{color:#848e9c; font-size:11px; font-weight:900}
    .v{font-size:14px; font-weight:950}
    .sep{height:1px; background:rgba(209,212,220,0.12); margin:12px 0}
    .warn{color:#d1d4dc; font-size:12px}
    .center{text-align:center}
    .hide{display:none !important}
  
    /* mini charts (landing) */
    .mini-charts{margin-bottom:12px;}
    .mini-box{background:#0b0e11; border:1px solid rgba(209,212,220,0.12); border-radius:14px; overflow:hidden;}
    #tv-mini{height:150px;}
    #lc-mini{height:120px;}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div>
          <div class="pill">ğŸ® 1íšŒ ì²´í—˜ (ì´ë©”ì¼ ì—†ìŒ)</div>
          <h1 style="margin-top:10px;">
            <span style="color:var(--gold);">BULL vs BEAR</span> : ë¹„íŠ¸ì½”ì¸ ë¡±Â·ìˆ ì—°ìŠµ ê²Œì„
          </h1>
          <div class="sub">
            ì‹¤ì „ íˆ¬ì ì „ì—, ì‹¤ì œ ì‹œì„¸ ê¸°ë°˜ìœ¼ë¡œ <b>í•œ ë²ˆ</b>ë§Œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.<br/>
            ì²´í—˜ì´ ëë‚˜ë©´ <b>ë³¸ ê²Œì„(ê¸°ë¡ ì €ì¥/ë­í‚¹)</b>ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
          </div>
        </div>

        <div class="row">
          <button class="btn btn-ghost" onclick="goIndex()">ë©”ì¸ìœ¼ë¡œ</button>
          <button class="btn btn-dark" onclick="goGame()">ë³¸ ê²Œì„ìœ¼ë¡œ</button>
        </div>
      </div>

      <div class="grid">
        
        <div class="panel">
          <!-- mini charts (top-left) -->
          <div class="mini-charts">
            <div class="mini-box" id="tv-mini"></div>
            <div style="height:10px;"></div>
            <div class="mini-box" id="lc-mini"></div>
          </div>

          <div class="row" style="justify-content:space-between;">
            <div>
              <div class="k">BTCUSDT ì‹¤ì‹œê°„ ê°€ê²©</div>
              <div id="price" class="price">$0.00</div>
              <div id="wsStatus" class="muted">ì—°ê²° ì¤‘â€¦</div>
            </div>
            <div class="pill" id="trialBadge">ğŸ”’ ì²´í—˜ 1íšŒ ì œí•œ</div>
          </div>

          <div class="sep"></div>

          <div id="trialLocked" class="center hide">
            <div style="font-weight:950; font-size:18px;">ì²´í—˜ 1íšŒê°€ ì´ë¯¸ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>
            <div class="sub" style="margin-top:8px;">ê³„ì†í•˜ë ¤ë©´ ë³¸ ê²Œì„ìœ¼ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.</div>
            <div class="row" style="justify-content:center; margin-top:12px;">
              <button class="btn btn-dark" onclick="goGame()">ë³¸ ê²Œì„ ì‹œì‘</button>
              <button class="btn btn-ghost" onclick="resetTrial()">ì²´í—˜ ë‹¤ì‹œ(í…ŒìŠ¤íŠ¸ìš©)</button>
            </div>
            <div class="muted" style="margin-top:10px;">* ìš´ì˜ ì¤‘ì—” â€œì²´í—˜ ë‹¤ì‹œâ€ ë²„íŠ¼ì„ ìˆ¨ê¸°ì„¸ìš”.</div>
          </div>

          <div id="trialPlay" class="hide">
            <div class="row">
              <div style="flex:1; min-width:220px;">
                <label>ì§„ì… ê¸ˆì•¡(USDT)</label>
                <input id="amt" type="number" inputmode="decimal" placeholder="ì˜ˆ: 1000" />
              </div>
              <div style="flex:1; min-width:220px;">
                <label>ë ˆë²„ë¦¬ì§€(x)</label>
                <input id="lev" type="number" inputmode="numeric" placeholder="ì˜ˆ: 10" />
              </div>
            </div>

            <div class="row" style="margin-top:12px;">
              <button id="btnLong" class="btn btn-long" onclick="enter('long')">LONG (1íšŒ)</button>
              <button id="btnShort" class="btn btn-short" onclick="enter('short')">SHORT (1íšŒ)</button>
              <button id="btnExit" class="btn btn-dark hide" onclick="exitPos()">EXIT</button>
            </div>

            <div id="posBox" class="sep hide"></div>

            <div id="posInfo" class="hide">
              <div class="kv">
                <div>
                  <div class="k">ë°©í–¥</div>
                  <div id="side" class="v">-</div>
                </div>
                <div style="text-align:right;">
                  <div class="k">í‰ê°€ ì†ìµ (Unrealized)</div>
                  <div id="pnl" class="v">-</div>
                </div>
                <div>
                  <div class="k">ì§„ì…ê°€</div>
                  <div id="entry" class="v">-</div>
                </div>
                <div style="text-align:right;">
                  <div class="k">ROE</div>
                  <div id="roe" class="v">-</div>
                </div>
              </div>

              <div class="muted" style="margin-top:12px;">
                * ì´ ì²´í—˜íŒì€ ì €ì¥/ë­í‚¹ì´ ì—†ê³ , <b>1íšŒ</b>ë§Œ ê°€ëŠ¥í•´ìš”.<br/>
                * â€œEXITâ€ í›„ ë³¸ ê²Œì„ìœ¼ë¡œ ìë™ ì´ë™í•©ë‹ˆë‹¤.
              </div>
            </div>

            <div id="doneBox" class="hide" style="margin-top:14px;">
              <div style="font-weight:950; font-size:18px;">ì²´í—˜ ì™„ë£Œ âœ…</div>
              <div class="sub" style="margin-top:8px;">ê²°ê³¼ë¥¼ ì €ì¥í•˜ê³  ê³„ì† í•˜ë ¤ë©´ ë³¸ ê²Œì„ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.</div>
              <div class="row" style="margin-top:12px;">
                <button class="btn btn-dark" onclick="goGame()">ë³¸ ê²Œì„ìœ¼ë¡œ</button>
                <button class="btn btn-ghost" onclick="goIndex()">ë©”ì¸ìœ¼ë¡œ</button>
              </div>
              <div class="muted" style="margin-top:10px;">3ì´ˆ í›„ ìë™ ì´ë™í•©ë‹ˆë‹¤â€¦</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div style="font-weight:950; font-size:16px;">ì´ ì²´í—˜íŒì´ í•˜ëŠ” ì¼</div>
          <div class="sep"></div>
          <div class="warn">
            âœ… ì‹¤ì‹œê°„ ì‹œì„¸ë¡œ ë¡±/ìˆ 1íšŒ ì²´í—˜<br/>
            âœ… ì†ìµ/ROE ë³€í™”ë¥¼ ì§ì ‘ í™•ì¸<br/>
            âœ… ëë‚˜ë©´ ë³¸ ê²Œì„ìœ¼ë¡œ ì´ë™ (ê¸°ë¡/ë­í‚¹ì€ ê·¸ìª½ì—ì„œ)<br/><br/>
            <span class="muted">
              â€» ë¸Œë¼ìš°ì €/ì¿ í‚¤ ë³€ê²½ ì‹œ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
              ë³¸ í˜ì´ì§€ëŠ” ê°€ìƒ ì‹œë®¬ë ˆì´ì…˜ì´ë©° ì‹¤ì œ íˆ¬ìì™€ ë¬´ê´€í•©ë‹ˆë‹¤.
            </span>
          </div>

          <div class="sep"></div>

          <div style="font-weight:950; font-size:16px;">ë³¸ ê²Œì„ì—ì„œ ê°€ëŠ¥í•œ ê²ƒ</div>
          <div class="sep"></div>
          <div class="warn">
            ğŸ† ìˆ˜ìµ ìˆ˜ìµë¥ /ê¸°ë¡ ì €ì¥<br/>
            ğŸ“Œ í™œë™ì§€ìˆ˜/ë“±ê¸‰ ë°˜ì˜<br/>
            ğŸ” ì´ë©”ì¼ ë“±ë¡ í›„ ì´ìš©
          </div>

          <div class="sep"></div>

          <div class="warn">
            ì´ ê²Œì„ì€ ê°€ìƒ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ì´ì§€ë§Œ,<br/>
            <b>ìˆ˜ìµ Â· ìˆ˜ìµë¥  Â· í™œë™ ê¸°ë¡</b>ì„ ê³„ì† ì €ì¥í•˜ê¸° ìœ„í•´<br/>
            ì´ë©”ì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.<br/><br/>
          
            ì´ë©”ì¼ ì—†ì´ ì´ìš©í•  ê²½ìš°<br/>
            ğŸ‘‰ ê¸°ë¡ì´ ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, <br>
            ì ‘ì†í•  ë•Œë§ˆë‹¤ ì²˜ìŒë¶€í„° ì‹œì‘ë˜ëŠ” ë‹¨ì ì´ ìˆì–´ <br>
            ë¶€ë“ì´ ì´ë©”ì¼ì„ ë°›ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.
           

          </div>
          
          <div class="sep"></div>
          
          <div class="muted">
            â€¢ ì´ë©”ì¼ì€ <b>ê²Œì„ ê¸°ë¡ ì €ì¥ ë° ê³„ì • ì‹ë³„ìš©</b>ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤<br/>
            â€¢ <b>ëŒ€ëŸ‰ ê´‘ê³ Â·ìŠ¤íŒ¸ ë©”ì¼ì€ ë°œì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</b><br/>
            â€¢ ë‹¤ë§Œ, ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸ ë˜ëŠ” ì¤‘ìš”í•œ ë³€ê²½ ì‚¬í•­ ì•ˆë‚´ ë©”ì¼ì´<br/>
              <b>ë“œë¬¼ê²Œ ë°œì†¡ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤</b><br/>
            â€¢ ì™¸ë¶€ ê³µê°œ âŒ / ì œ3ì ì œê³µ âŒ<br/><br/>
          
            âš ï¸ ì´ë©”ì¼ì€ <b>ë‚˜ì˜ ê°€ìƒ íˆ¬ì ê¸°ë¡ì„ ì§€í‚¤ëŠ” ì—´ì‡ </b>ì´ë¯€ë¡œ<br/>
            ë°˜ë“œì‹œ ê¸°ì–µí•´ ì£¼ì„¸ìš”.
          </div>
          
          <div class="sep"></div>


          <div class="center">
            <button class="btn btn-dark" style="width:100%;" onclick="goGame()">ë³¸ ê²Œì„ ì‹œì‘</button>
            <div class="muted" style="margin-top:10px;">* ë³¸ ê²Œì„ì—ì„œë§Œ ì´ë©”ì¼ ì¸ì¦ì´ ë‚˜ì˜µë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const TRIAL_KEY = "tg_trial_used_v1";
  const PRICE_EL = document.getElementById("price");
  const WS_EL = document.getElementById("wsStatus");

  const locked = (localStorage.getItem(TRIAL_KEY) === "1");

  const viewLocked = document.getElementById("trialLocked");
  const viewPlay   = document.getElementById("trialPlay");

  function showLocked(){
    viewLocked.classList.remove("hide");
    viewPlay.classList.add("hide");
  }
  function showPlay(){
    viewLocked.classList.add("hide");
    viewPlay.classList.remove("hide");
  }

  if (locked) showLocked(); else showPlay();

  // defaults
  const amtEl = document.getElementById("amt");
  const levEl = document.getElementById("lev");
  amtEl.value = "1000";
  levEl.value = "10";

  let btc = 0;
  let pos = null; // { side, entry, amt, lev, openedAt }
  let doneTimer = null;

  function fmtMoney(n){
    if (!isFinite(n)) return "-";
    return "$" + Math.abs(n).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }
  function fmtPrice(n){
    if (!isFinite(n)) return "$0.00";
    return "$" + n.toLocaleString(undefined, { maximumFractionDigits: 1 });
  }

  function paint(){
    PRICE_EL.textContent = fmtPrice(btc);

    if (!pos) return;

    const diff = (btc - pos.entry) / pos.entry * (pos.side === "short" ? -1 : 1);
    const pnl  = pos.amt * diff * pos.lev;
    const roe  = diff * pos.lev * 100;

    const sideEl = document.getElementById("side");
    const entryEl = document.getElementById("entry");
    const pnlEl = document.getElementById("pnl");
    const roeEl = document.getElementById("roe");

    sideEl.textContent = (pos.side === "long" ? "LONG" : "SHORT") + "  " + pos.lev + "x";
    sideEl.style.color = (pos.side === "long") ? "var(--green)" : "var(--red)";
    entryEl.textContent = fmtPrice(pos.entry);

    pnlEl.textContent = (pnl >= 0 ? "+" : "-") + fmtMoney(pnl);
    pnlEl.style.color = (pnl >= 0) ? "var(--green)" : "var(--red)";

    roeEl.textContent = (roe >= 0 ? "+" : "") + roe.toFixed(2) + "%";
    roeEl.style.color = (roe >= 0) ? "var(--green)" : "var(--red)";
  }


  // ===== mini charts init (TradingView + lightweight-charts) =====
  let __miniInited = false;
  let __lcChart = null;
  let __lcSeries = null;
  let __lcLastTime = 0;

  function initMiniCharts(){
    if (__miniInited) return;
    __miniInited = true;

    // TradingView mini widget
    try{
      if (window.TradingView && document.getElementById("tv-mini")){
        new TradingView.widget({
          autosize: true,
          symbol: "BYBIT:BTCUSDT.P",
          interval: "5",
          timezone: "Etc/UTC",
          theme: "dark",
          style: "1",
          locale: "kr",
          hide_top_toolbar: true,
          hide_legend: true,
          allow_symbol_change: false,
          save_image: false,
          container_id: "tv-mini"
        });
      }
    }catch(e){}

    // lightweight-charts mini line
    try{
      const el = document.getElementById("lc-mini");
      if (!el || !window.LightweightCharts) return;

      __lcChart = LightweightCharts.createChart(el, {
        layout: { backgroundColor: "#0b0e11", textColor: "#9aa4b2" },
        grid: { vertLines: { color: "rgba(43,49,57,0.4)" }, horzLines: { color: "rgba(43,49,57,0.4)" } },
        rightPriceScale: { borderColor: "rgba(43,49,57,0.6)" },
        timeScale: { borderColor: "rgba(43,49,57,0.6)", timeVisible: true, secondsVisible: false },
        crosshair: { mode: 0 }
      });

      __lcSeries = __lcChart.addLineSeries({ lineWidth: 2 });

      // initial size fix
      setTimeout(() => {
        try{
          const r = el.getBoundingClientRect();
          __lcChart.resize(Math.floor(r.width), Math.floor(r.height));
        }catch(e){}
      }, 50);

      // resize on window
      window.addEventListener("resize", () => {
        try{
          const r = el.getBoundingClientRect();
          __lcChart.resize(Math.floor(r.width), Math.floor(r.height));
        }catch(e){}
      }, { passive:true });

    }catch(e){}
  }

  function pushMiniPrice(price){
    try{
      if (!__miniInited) initMiniCharts();
      if (!__lcSeries || !isFinite(price)) return;

      const t = Math.floor(Date.now() / 1000);
      if (t === __lcLastTime) return;
      __lcLastTime = t;

      __lcSeries.update({ time: t, value: price });
    }catch(e){}
  }
  // ============================================================


  // Bybit public WS
  try{
    const ws = new WebSocket("wss://stream.bybit.com/v5/public/linear");
    ws.onopen = () => {
      WS_EL.textContent = "ì‹¤ì‹œê°„ ì—°ê²°ë¨";
      ws.send(JSON.stringify({ op:"subscribe", args:["tickers.BTCUSDT"] }));
    };
    ws.onmessage = (e) => {
      try{
        const d = JSON.parse(e.data);
        if (d && d.data && d.data.lastPrice){
          btc = parseFloat(d.data.lastPrice);
          paint();
          pushMiniPrice(btc);
        }
      }catch(err){}
    };
    ws.onclose = () => { WS_EL.textContent = "ì—°ê²° ì¢…ë£Œë¨ (ìƒˆë¡œê³ ì¹¨ í•´ë³´ì„¸ìš”)"; };
    ws.onerror = () => { WS_EL.textContent = "ì—°ê²° ì˜¤ë¥˜ (ë„¤íŠ¸ì›Œí¬ í™•ì¸)"; };
  }catch(e){
    WS_EL.textContent = "ì›¹ì†Œì¼“ ì‹¤íŒ¨ (ë¸Œë¼ìš°ì € ì œí•œ ê°€ëŠ¥)";
  }

  // expose controls
  window.enter = function(side){
    if (localStorage.getItem(TRIAL_KEY) === "1"){
      alert("ì²´í—˜ 1íšŒê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë³¸ ê²Œì„ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
      goGame();
      return;
    }
    if (!isFinite(btc) || btc <= 0){
      alert("ê°€ê²©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œìš”.");
      return;
    }
    const amt = Number(amtEl.value);
    const lev = Number(levEl.value);
    if (!isFinite(amt) || amt <= 0) return alert("ì§„ì… ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (!isFinite(lev) || lev <= 0) return alert("ë ˆë²„ë¦¬ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    // open pos
    pos = { side, entry: btc, amt, lev, openedAt: Date.now() };

    // lock trial immediately after first entry
    localStorage.setItem(TRIAL_KEY, "1");

    // UI
    document.getElementById("btnLong").classList.add("hide");
    document.getElementById("btnShort").classList.add("hide");
    document.getElementById("btnExit").classList.remove("hide");

    document.getElementById("posBox").classList.remove("hide");
    document.getElementById("posInfo").classList.remove("hide");

    paint();
  };

  window.exitPos = function(){
    if (!pos) return;
    pos = null;

    document.getElementById("btnExit").classList.add("hide");
    document.getElementById("doneBox").classList.remove("hide");

    clearTimeout(doneTimer);
    doneTimer = setTimeout(() => goGame(), 3000);
  };

  window.goGame = function(){ location.href = "game.html"; };
  window.goIndex = function(){ location.href = "index.html"; };

  // test helper
  window.resetTrial = function(){
    localStorage.removeItem(TRIAL_KEY);
    location.reload();
  };
})();
</script>

<!-- GoatCounter -->
<script>
  window.goatcounter = { no_onload: true };
</script>
<script async src="https://gc.zgo.at/count.js"
        data-goatcounter="https://bit-model-123.goatcounter.com/count"></script>

<script>
  // landing page view
  setTimeout(function(){
    try{
      window.goatcounter?.count?.({ path: location.pathname + "#landing" });
    }catch(e){}
  }, 500);

  // expose helpers for navigation tracking
  (function(){
    const _goGame = window.goGame;
    const _goIndex = window.goIndex;

    window.goGame = function(){
      try{ window.goatcounter?.count?.({ path: location.pathname + "#to_game" }); }catch(e){}
      return _goGame && _goGame();
    };
    window.goIndex = function(){
      try{ window.goatcounter?.count?.({ path: location.pathname + "#to_index" }); }catch(e){}
      return _goIndex && _goIndex();
    };
  })();
</script>

</body>
</html>
